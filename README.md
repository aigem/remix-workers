# Remix + Cloudflare é¡¹ç›®

æ¬¢è¿ä½¿ç”¨ Remix + Cloudflare é¡¹ç›®æ¨¡æ¿!

## æ–‡æ¡£å‚è€ƒ

- ğŸ“– [Remix æ–‡æ¡£](https://remix.run/docs)
- ğŸ“– [Remix Cloudflare æ–‡æ¡£](https://remix.run/guides/vite#cloudflare)

# Remix + Cloudflare Workers é¡¹ç›®åˆ†æ

è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªä½¿ç”¨ Remix æ¡†æ¶åœ¨ Cloudflare Workers å¹³å°ä¸Šè¿è¡Œçš„ Web åº”ç”¨ç¨‹åºã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£å…¶ä¸»è¦ç‰¹æ€§å’Œé…ç½®:

## 1. é¡¹ç›®ç»“æ„å’ŒæŠ€æœ¯æ ˆ

- å‰ç«¯æ¡†æ¶: React + Remix
- éƒ¨ç½²å¹³å°: Cloudflare Workers
- æ„å»ºå·¥å…·: Vite
- æ ·å¼: Tailwind CSS
- è¯­è¨€: TypeScript

é¡¹ç›®éµå¾ªæ ‡å‡†çš„ Remix ç»“æ„,ä¸»è¦åŒ…å«:

- `app/`: åº”ç”¨ç¨‹åºæºä»£ç 
- `public/`: é™æ€èµ„æº
- `functions/`: Cloudflare Pages å‡½æ•°
- é…ç½®æ–‡ä»¶: å¦‚ `wrangler.toml`, `vite.config.ts` ç­‰

## 2. Cloudflare Workers é›†æˆ

é¡¹ç›®ä¸“é—¨ä¸º Cloudflare Workers å¹³å°ä¼˜åŒ–ã€‚ä¸»è¦é›†æˆç‚¹åŒ…æ‹¬:

1. `functions/[[path]].ts` æ–‡ä»¶:

```1:8:functions/[[path]].ts
import { createPagesFunctionHandler } from "@remix-run/cloudflare-pages";

// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore - the server build file is generated by `remix vite:build`
// eslint-disable-next-line import/no-unresolved
import * as build from "../build/server";

export const onRequest = createPagesFunctionHandler({ build });
```

è¿™ä¸ªæ–‡ä»¶ä½¿ç”¨ `createPagesFunctionHandler` æ¥å¤„ç†è¯·æ±‚,æ˜¯ Cloudflare Pages ä¸ Remix é›†æˆçš„å…³é”®ã€‚

2. `wrangler.toml` é…ç½®:

```1:12:wrangler.toml
#:schema node_modules/wrangler/config-schema.json
name = "remix-workers"
compatibility_date = "2024-09-25"
main = "./build/worker/index.js"
assets = { directory = "./build/client" }

# Workers Logs
# Docs: https://developers.cloudflare.com/workers/observability/logs/workers-logs/
# Configuration: https://developers.cloudflare.com/workers/observability/logs/workers-logs/#enable-workers-logs
[observability]
enabled = true

```

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº† Workers çš„é…ç½®,åŒ…æ‹¬å…¥å£ç‚¹ã€èµ„æºç›®å½•ç­‰ã€‚

3. ç±»å‹ç”Ÿæˆ:
é¡¹ç›®ä½¿ç”¨ `wrangler types` å‘½ä»¤ä¸º Cloudflare ç»‘å®šç”Ÿæˆç±»å‹å®šä¹‰:

```13:15:package.json
    "typegen": "wrangler types",
    "preview": "pnpm run build && wrangler dev",
    "cf-typegen": "wrangler types"
```


## 3. Remix ç‰¹æ€§åˆ©ç”¨

1. æ–‡ä»¶ç³»ç»Ÿè·¯ç”±:
ä¸»é¡µé¢åœ¨ `app/routes/_index.tsx` ä¸­å®šä¹‰ã€‚

2. æ•°æ®åŠ è½½å’ŒåŠ¨ä½œ:
è™½ç„¶å½“å‰ç¤ºä¾‹ä¸­æ²¡æœ‰å±•ç¤º,ä½† Remix æ”¯æŒé€šè¿‡ `loader` å’Œ `action` å‡½æ•°è¿›è¡ŒæœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ã€‚

3. å…ƒæ•°æ®å¤„ç†:

```1:8:app/routes/_index.tsx
import type { MetaFunction } from "@remix-run/cloudflare";

export const meta: MetaFunction = () => {
  return [
    { title: "New Remix App" },
    { name: "description", content: "Welcome to Remix!" },
  ];
};
```


## 4. æ€§èƒ½ä¼˜åŒ–

1. é™æ€èµ„æºå¤„ç†:

```1:5:public/_headers
/favicon.ico
  Cache-Control: public, max-age=3600, s-maxage=3600
/assets/*
  Cache-Control: public, max-age=31536000, immutable

```

è¿™ä¸ªæ–‡ä»¶è®¾ç½®äº†é™æ€èµ„æºçš„ç¼“å­˜ç­–ç•¥,æœ‰åŠ©äºæé«˜æ€§èƒ½ã€‚

2. è·¯ç”±æ§åˆ¶:

```1:6:public/_routes.json
{
  "version": 1,
  "include": ["/*"],
  "exclude": ["/favicon.ico", "/assets/*"]
}

```

è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†å“ªäº›è·¯å¾„åº”è¯¥ç”± Workers å¤„ç†ã€‚

3. Tailwind CSS:
ä½¿ç”¨ Tailwind å¯ä»¥ç”Ÿæˆä¼˜åŒ–çš„ CSS,å‡å°‘ä¸å¿…è¦çš„æ ·å¼ä»£ç ã€‚

## 5. å¼€å‘å’Œéƒ¨ç½²æµç¨‹

1. å¼€å‘:
```sh
pnpm run dev
# ç”Ÿæˆç±»å‹å®šä¹‰ï¼Œåœ¨wrangler.tomlä¸­æ·»åŠ bindingsæˆ–ä¿®æ”¹åè¿è¡Œ
npm run cf-typegen 
```

2. æ„å»º:
```sh
pnpm run build
```

3. éƒ¨ç½²:
```sh
pnpm run deploy
```

è¿™äº›å‘½ä»¤åœ¨ `package.json` ä¸­å®šä¹‰,åˆ©ç”¨äº† Wrangler CLI å·¥å…·ã€‚

## 6. ç¯å¢ƒé€‚é…

é¡¹ç›®é…ç½®æ”¯æŒåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒå’Œ Cloudflare Workers ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œã€‚`vite.config.ts` æ–‡ä»¶ä¸­çš„ `remixCloudflareDevProxy` æ’ä»¶å¸®åŠ©æ¨¡æ‹Ÿ Cloudflare ç¯å¢ƒ:


```1:20:vite.config.ts
import {
  vitePlugin as remix,
  cloudflareDevProxyVitePlugin as remixCloudflareDevProxy,
} from "@remix-run/dev";
import { defineConfig } from "vite";
import tsconfigPaths from "vite-tsconfig-paths";

export default defineConfig({
  plugins: [
    remixCloudflareDevProxy(),
    remix({
      future: {
        v3_fetcherPersist: true,
        v3_relativeSplatPath: true,
        v3_throwAbortReason: true,
      },
    }),
    tsconfigPaths(),
  ],
});
```


## 7. å®‰å…¨æ€§å’Œæœ€ä½³å®è·µ

1. ESLint é…ç½®ç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§ã€‚
2. TypeScript æä¾›äº†ç±»å‹å®‰å…¨ã€‚
3. é¡¹ç›®é¿å…ä½¿ç”¨ Google Fonts,å¯èƒ½æ˜¯å‡ºäºæ€§èƒ½æˆ–éšç§è€ƒè™‘ã€‚

## 8. æ‰©å±•æ€§

1. é¡¹ç›®ç»“æ„å…è®¸è½»æ¾æ·»åŠ æ–°è·¯ç”±å’Œç»„ä»¶ã€‚
2. `wrangler.toml` å¯ä»¥é…ç½®é¢å¤–çš„ Cloudflare Workers åŠŸèƒ½,å¦‚ KV å­˜å‚¨ã€Durable Objects ç­‰ã€‚

## 9. æ³¨æ„äº‹é¡¹

1. ç¡®ä¿äº†è§£ Cloudflare Workers çš„é™åˆ¶,å¦‚æ‰§è¡Œæ—¶é—´å’Œå†…å­˜é™åˆ¶ã€‚
2. è€ƒè™‘ä½¿ç”¨ Cloudflare çš„å…¶ä»–æœåŠ¡,å¦‚ KV å­˜å‚¨æˆ– D1 æ•°æ®åº“,ä»¥å¢å¼ºåº”ç”¨åŠŸèƒ½ã€‚

